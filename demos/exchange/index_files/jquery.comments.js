/*!
 * comments jQuery Plugin v2.5.1
 *
 * © 2016 АО «Коммерсантъ»
 * All rights reserved
 */
!function($){"use strict";var e,t,n="comments",o=n+"Authorized",r=n+"UserData",a=n+"User",i=n+"Deep",s="kommersantUserRegisterSocial",l="https://i.kommersant.ru",d=l+"/user/ProfileInfoMyCommon",c=l+"/user/RegisterSocial",u=l+"/user/Logout",p=l+"/comments/CommentsList",f=l+"/comments/CommentAdd",m=l+"/comments/CommentUpdate",h=l+"/comments/CommentLike",v="/lk/socialcallback",g="http://im.kommersant.ru/ContentFlex/ajax/comments/templates.html?20160325000332",y="http://im.kommersant.ru/ContentFlex/images/noavatar.png",C=n,b=n+"-block",w=n+"-item",I=n+"-item-deleted",x=n+"-item-more",j=n+"-item-children",k=n+"-item-reply",T=n+"-modified",U=n+"-spoiler",D=n+"-spoiler-button",E=n+"-spoiler-replies",R=n+"-spoiler-replies-show",S=n+"-reply",P=n+"-reply-avatar",N=n+"-reply-unauthorized",M=n+"-reply-authorized",A=n+"-reply-note",F=n+"-alert",z=n+"-loading",O=n+"-text-textarea-comment",H=n+"-text-textarea-reply",K=n+"-text-modified-author",L=n+"-text-modified-moderator",W=n+"-text-edit-note",J=n+"-text-button-comment",B=n+"-text-button-reply",G=n+"-text-button-edit",Q=n+"-text-button-more-comments",Y=n+"-text-button-more-replies",q=n+"-text-alert-header",V=n+"-text-alert-error-default",X=n+"-text-alert-error-ajax",Z=n+"-text-alert-error-spam",_=n+"-text-alert-error-uneditable",ee=n+"-text-alert-error-deleted",te=n+"-text-alert-error-unauthorized",ne=n+"-id",oe=n+"-source",re=n+"-vote",ae=n+"-disabled",ie=n+"-message",se=n+"-is-authorized",le=n+"-is-not-authorized",de=n+"-is-deep",ce=n+"-is-not-deep",ue=n+"-is-loaded",pe=n+"-is-not-loaded",fe=n+"-loading",me=n+"-toolbar-summary-total",he=n+"-toolbar-deep-toggle",ve=n+"-item",ge=n+"-item-0",ye=n+"-item-is-deleted",Ce=n+"-item-is-own",be=n+"-item-is-not-own",we=n+"-item-is-editable",Ie=n+"-item-is-not-editable",xe=n+"-item-is-expanded",je=n+"-item-is-not-expanded",ke=n+"-item-is-complete",Te=n+"-item-is-not-complete",Ue=n+"-item-is-editing",De=n+"-item-body",Ee=n+"-item-message",Re=n+"-item-modified",Se=n+"-item-edit",Pe=n+"-item-reply",Ne=n+"-item-children",Me=n+"-more-trigger",Ae=n+"-spoiler-reply",Fe=n+"-spoiler-replies",ze=n+"-reply",Oe=n+"-login",He=n+"-logout",Ke=n+"-reply-avatar",Le=n+"-reply-auth",We=n+"-reply-form",Je=n+"-reply-message",Be=n+"-reply-button",Ge=n+"-reply-alert",Qe=n+"-edit-button",Ye=n+"-vote",qe=n+"-vote-is-enabled",Ve=n+"-vote-is-disabled",Xe=n+"-vote-is-like",Ze=n+"-vote-is-dislike",$e=n+"-vote-button",_e=n+"-vote-rating",et=n+"-reputation-positive",tt=n+"-reputation-negative",nt=n+"-mention",ot=333,rt=1e4,at=100,it='<div class="comments-alert"><h4 class="comments-alert-header">Ваш браузер устарел</h4><p class="comments-alert-text">Пожалуйста, обновите его.</p></div>',st=-1!==document.cookie.indexOf(i+"=1"),lt={project:1,objectType:1,objectId:1,isDeep:st,limitComments:10,limitReplies:100,editExpires:6e5},dt={1:"fb",2:"vk",3:"lj",4:"gp",5:"tw",6:"ok",7:"oi"},ct=[],ut=[],pt=[],ft=[],mt=[],ht=[],vt=null,gt=!1,yt=!1,Ct=!1,bt=!1,wt={},It={},xt="",jt=0,kt=$(window),Tt=function(e,t,n,o){if("number"!=typeof e||isNaN(e))return e;if("number"==typeof t&&t>=0){t=Math.floor(t);var r=Math.pow(10,t);e=Math.round(e*r)/r}var a=e.toString(),i=a.split(".",2),s=i[0].replace(/^-/,"−"),l=i[1],d="",c=0;if(Math.abs(e)>=1e4)for(var u=s.length-1;u>=0;u-=1)d=s[u]+d,c++,3===c&&u>0&&(c=0,d=("string"==typeof o?o:" ")+d);else d=s;return"undefined"!=typeof i[1]&&(d+=("string"==typeof n?n:",")+l),d},Ut=function(e){return("0"+e.getDate()).slice(-2)+"."+("0"+(e.getMonth()+1)).slice(-2)+"."+("0"+e.getFullYear()).slice(-2)},Dt=function(e){return e.getHours()+":"+("0"+e.getMinutes()).slice(-2)},Et=function(e){return new Date(parseInt(e.slice(6),10))},Rt=function(){var e=new Date;return e.setUTCMilliseconds(e.getUTCMilliseconds()+jt),e},St=function(){return window.location.hostname.split(".").splice(-2).join(".")},Pt=function(e){return"string"!=typeof e||""===e?"":(document.cookie.match(new RegExp(e+"=([^;]*)"))||["",""])[1]},Nt=function(e){"string"==typeof e&&""!==e&&(document.cookie=e+"=; domain=."+window.location.hostname.split(".").splice(-2).join(".")+"; path=/; expires="+new Date(0))},Mt=function(e,t){return"object"!=typeof e||"object"!=typeof t?0:e.Id-t.Id},At=function(){for(var e=0;e<mt.length;e+=1)mt[e]()},Ft=function(){for(var e=0;e<ht.length;e+=1)ht[e]()},zt=function(e){st=e;var t=new Date;t.setDate(t.getDate()+7);var n=t.toUTCString();document.cookie=i+"="+(st?"1":"0")+"; domain=."+St()+"; path=/; expires="+n},Ot=function(e){if("undefined"==typeof e&&(e=function(){}),yt)return void e();if(ct.push(e),!gt){gt=!0;var t=$("<div>");$.ajax({url:g,method:"GET",success:function(e){if("undefined"!=typeof e){t.html(e);var n,o=t.find(".template");for(o.each(function(){var e=$(this),t=e.data("template-name")||"";""!==t&&(It[t]=e.html())}),t.remove(),yt=!0,n=0;n<ct.length;n+=1)ct[n]();ct=[]}},error:function(e,t,n){"error"===t&&"No Transport"===n?At():Ft()}})}},Ht=function(e,t){var n;if("string"!=typeof e||""===e)return"";var o=e;if("object"==typeof t&&!(t instanceof Array))for(n in t)o=o.replace(new RegExp("{{"+n+"}}","g"),t[n]);return o=o.replace(new RegExp("{{.*}}","g"),"")},Kt=function(){var e;for(e=0;e<ut.length;e+=1)ut[e]()},Lt=function(e){var t="object"==typeof e;t&&(t=0===e.ErrorCode&&1===e.Status),vt=t,t?("undefined"!=typeof e.Rating&&(e.Rating=parseInt(e.Rating,10)||0),wt=e):wt={}},Wt=function(){var e,t=new Date;t.setUTCHours(t.getUTCHours()+12);var n=t.toUTCString();try{e=escape(JSON.stringify(wt))}catch(r){e="{}"}document.cookie=o+"="+(vt?"1":"0")+"; domain=."+St()+"; path=/; expires="+n,document.cookie=a+"="+e+"; domain=."+St()+"; path=/; expires="+n,xt=Pt(a)},Jt=function(){var e,t="1"===Pt(o),n=Pt(a);if(t!==vt||t&&n!==xt){if(xt=n,t){try{e=JSON.parse(unescape(n))}catch(r){e={}}Lt(e)}else Lt(!1);Kt()}},Bt=function(){bt||(window.setInterval(Jt,500),bt=!0)},Gt=function(){var e;if(st)for(e=0;e<pt.length;e+=1)pt[e]();else for(e=0;e<ft.length;e+=1)ft[e]()},Qt=function(e,t,n,o){var r=void 0!=window.screenLeft?window.screenLeft:screen.left,a=void 0!=window.screenTop?window.screenTop:screen.top,i=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,s=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,l=i/2-n/2+r,d=s/2-o/2+a,c=window.open(e,t,"scrollbars=yes, width="+n+", height="+o+", top="+d+", left="+l);return window.focus&&c.focus(),c},Yt=function(n,o){var a={socialNetwork:n,project:o,callbackUrl:window.location.protocol+"//"+window.location.host+v};e=Qt(c+"?"+$.param(a),s,800,600),Ct||(Ct=!0,t=window.setInterval(function(){var n=Pt(r);Nt(r);var o;if("undefined"!=typeof n&&""!==n){window.clearInterval(t),Ct=!1;try{o=JSON.parse(unescape(n))}catch(a){o={}}if("object"!=typeof o)return;try{e.close()}catch(a){}Lt(o),Wt(),Kt()}},10))},qt=function(e,t){$.ajax({xhrFields:{withCredentials:!0},url:d,method:"POST",data:{project:e},success:function(e){Lt(e),Wt(),Kt(),"undefined"!=typeof t&&t()},error:function(e,t,n){"error"===t&&"No Transport"===n&&At()}})},Vt=function(){Lt(!1),Wt(),Kt(),$.ajax({xhrFields:{withCredentials:!0},url:u,method:"POST"})},Xt=function(e){return dt[e]||""},Zt=function(t){"object"==typeof t&&("undefined"!=typeof e&&"undefined"!=typeof e.close&&e.close(),Lt(t),Wt(),Kt())};kt.on("message",function(e){e.originalEvent.origin===window.location.protocol+"//"+window.location.host&&Zt(e.originalEvent.data)}),window.userRegisterSocialCallback=function(e){Zt(e)},$.fn[n]=function(e){var t=$.extend({},lt,e);return t.isDeep&&zt(!0),this.each(function(){var e=[],n=[],r=!1,a=0,i=-1,s=[],l=$(this),d=function(){l.html(it),c()},c=function(){l.children("."+fe).remove(),l.removeClass(pe),l.addClass(ue),r=!0},u=function(e){"undefined"!=typeof e&&e||(e=null);var n,o=l.find("."+ve+"-"+(e||0)),r=o.children("."+Pe),a=Ht(It[e?B:J]),i=Ht(It[e?H:O]),s=Ht(It[P],{userAvatar:wt.Avatar||y,userReputation:"",userRating:" "});n=vt?Ht(It[M],{userSource:Xt(wt.SocialNetwork),userName:wt.UserName||""}):Ht(It[N]),r.html(Ht(It[b],{content:Ht(It[S],{label:a,placeholder:i,action:f,project:t.project,objectType:t.objectType,objectId:t.objectId,parentId:e||"",avatar:s,auth:n})}))},v=function(n){var o,r,a;if("undefined"!=typeof n&&n&&-1!==(o=Ct(n))){var i,s=l.find("."+ve+"-"+(n||0)),r=s.children("."+Se),d=Ht(It[G]),c=Ht(It[P],{userAvatar:wt.Avatar||y,userReputation:"",userRating:" "});i=vt?Ht(It[M],{userSource:Xt(wt.SocialNetwork),userName:wt.UserName||""}):Ht(It[N]),s.addClass(Ue),r.html(Ht(It[S],{label:d,action:m,project:t.project,objectType:t.objectType,objectId:t.objectId,commentId:n||"",avatar:c,message:e[o].Message,auth:i,note:Ht(It[A],{text:Ht(It[W],{minutes:Math.floor(t.editExpires/6e4)})})})),a=r.find("."+Je),a.data(ie,$.trim(e[o].Message)),a.focus().select()}},g=function(e){var t=$(e.form);""===e.form.commentId.value?t.closest("."+Pe).html(Zt(parseInt(e.form.parentId.value,10)||null,!0)):(t.closest("."+ve).removeClass(Ue),t.closest("."+Se).empty())},lt=function(){var e,t,n=l.find("."+ze),o=l.find("."+Ye);vt?(e=Ht(It[P],{userAvatar:wt.Avatar||y,userReputation:"",userRating:" "}),t=Ht(It[M],{userSource:Xt(wt.SocialNetwork),userName:wt.UserName||""}),l.removeClass(le),l.addClass(se)):(e=Ht(It[P],{userAvatar:y}),t=Ht(It[N]),l.removeClass(se),l.addClass(le)),n.find("."+Ke).html(e),n.find("."+Le).html(t),n.find("."+Je).change(),dt(),o.removeClass(Ve+" "+Xe+" "+Ze),o.addClass(qe)},dt=function(n){var o,r,a,i,s,d,c,u,p;for("undefined"!=typeof n&&n&&-1!==(o=Ct(n))?(r=o,a=o+1):(r=0,a=e.length),o=r;a>o;o+=1)p=l.find("."+ve+"-"+e[o].Id),vt?(i=Et(e[o].Date),s=Rt()-i,d=2===e[o].Status||0===e[o].Message.length,c=e[o].UserId===wt.UserId,u=!d&&c&&Rt()-i<t.editExpires):(c=!1,u=!1),p.removeClass((c?be:Ce)+" "+(u?Ie:we)),p.addClass((c?Ce:be)+" "+(u?we:Ie)),!u&&p.hasClass(Ue)&&g(p.children("."+Se).find("."+Je).get(0))},ct=function(){st?(l.removeClass(ce),l.addClass(de)):(l.removeClass(de),l.addClass(ce))},gt=function(){for(var e;e=s.pop();)try{e.abort()}catch(t){}},yt=function(e,n,o,i){"undefined"!=typeof e&&e||(e=null),"undefined"!=typeof n&&n||(n=null),"undefined"!=typeof o&&o||(o=null);var d=l.find("."+ve+"-"+(e||0)),c=d.children("."+Ne),f={project:t.project,objectType:t.objectType,objectId:t.objectId,getTree:st&&!e,pageSize:"number"==typeof i?i:t.limitComments};e&&(f.parentId=e),f.startCommentId=n,f.endCommentId=o,s.push($.ajax({xhrFields:{withCredentials:!0},url:p,method:"POST",data:f,success:function(e){"object"==typeof e&&0===e.ErrorCode&&"object"==typeof e.Comments&&(a="number"==typeof e.TotalCount?e.TotalCount:0,"undefined"!=typeof e.ServerDateTime&&(jt=Et(e.ServerDateTime)-new Date),r||(l.children("."+fe).remove(),u(),l.removeClass(pe),l.addClass(ue),r=!0),Qt(e.Comments),en())},error:function(t,r,a){return"error"===r&&"No Transport"===a?void At():(e&&!n&&(d.removeClass(xe+" "+Te),d.addClass(je+" "+ke)),void(n&&!o&&(d.removeClass(ke),d.addClass(Te))))},complete:function(){c.children("."+fe).remove()}}))},Ct=function(t){for(var n=0,o=-1;n<e.length&&e[n].Id!==t;)n+=1;return n<e.length&&(o=n),o},bt=function(t){var n,o=null;for("undefined"!=typeof t&&t||(t=null),n=0;n<e.length;n+=1)if(e[n].ParentId===t){o=n;break}return o},xt=function(t){var n,o=null;for("undefined"!=typeof t&&t||(t=null),n=e.length-1;n>=0;n-=1)if(e[n].ParentId===t){o=n;break}return o},St=function(t){var n;return"undefined"!=typeof t&&t||(t=null),n=bt(t),"number"==typeof n?e[n].Id:null},Nt=function(t){var n;return"undefined"!=typeof t&&t||(t=null),n=xt(t),"number"==typeof n?e[n].Id:null},Ft=function(t){var n,o=!1;for(n=0;n<e.length;n+=1)if(e[n].Id===t){o=!0;break}return o},Qt=function(t){var n;if("object"==typeof t&&t instanceof Array&&0!==t.length){for(n=0;n<t.length;n+=1)"object"==typeof t[n]&&(Ft(t[n].Id)||e.push(t[n]));e.sort(Mt)}},Zt=function(t,n){var o,r,a;for(o=0;o<e.length;o+=1)if(e[o].Id===t)return r=e[o].ChildrenCount,a=2===e[o].Status||0===e[o].Message.length,a&&(n||0===r)?"":Ht(It[U],{button:a?"":Ht(It[D]),replies:r>0?Ht(It[E],{count:r,show:!n&&r>0?Ht(It[R]):""}):""})},$t=function(t){var o,r,a,i=[];for("undefined"!=typeof t&&t||(t=null),o=0;o<e.length;o+=1)e[o].ParentId===t&&i.push(e[o].Id);if(i.length>0){for(o=0;o<i.length;o+=1)$t(i[o]);for(o=e.length-1;o>=0;o-=1)e[o].ParentId===t&&(r=$.inArray(e[o].Id,n),r>=0&&n.splice(r,1),e.splice(o,1))}a=l.find("."+ve+"-"+(t||0)),a.removeClass(xe+" "+Te),a.addClass(je+" "+ke),a.children("."+Ne).empty(),a.children("."+Pe).html(Zt(t,!1))},_t=function(){var t;for(t=0;t<e.length;t+=1)e[t].ParentId||$t(e[t].Id)},en=function(){var o,r,s,d,c,u,p,f,m,h,v,g,C,b,U={},D={};for(o=0;o<e.length;o+=1)($.inArray(e[o].Id,n)>=0&&"undefined"==typeof U[e[o].ParentId]||e[o].Id<U[e[o].ParentId])&&(U[e[o].ParentId]=e[o].Id);for(a>i&&(0>i&&(d=bt(),h=!d||e[d].IsFirst,g=l.find("."+ge),g.removeClass(je),g.addClass(xe+" "+h?ke:Te)),l.find("."+me).html(a),i=a),o=0;o<e.length;o+=1)r=e[o].Id,s=e[o].ParentId,"undefined"==typeof D[s]&&(D[s]=r),$.inArray(r,n)>=0||(n.push(r),c=Et(e[o].Date),u=Rt()-c,d=bt(s),p=2===e[o].Status||0===e[o].Message.length,f=e[o].UserId===wt.UserId,m=!p&&f&&u<t.editExpires,h=!d||e[d].IsFirst,C=l.find("."+ve+"-"+(s||0)),b=C.children("."+Ne),r===D[s]&&!e[o].IsFirst&&C.hasClass(ke)&&(C.removeClass(ke),C.addClass(Te)),v=Ht(It[w],{id:r,classes:(p?" "+ye:"")+" "+(f?Ce:be)+" "+(m?we:Ie)+" "+(st?xe:je)+" "+(h?ke:Te),userAvatar:e[o].UserAvatar||y,userReputation:"",userRating:" ",userName:e[o].UserName,messageDate:Ut(c),messageTime:Dt(c),messageReputation:0!==e[o].Rating?" "+(e[o].Rating>0?et:tt):"",messageRating:Tt(e[o].Rating),messageText:p?Ht(It[I]):e[o].Message,modified:!p&&e[o].UpdaterUserType?Ht(It[T],{by:Ht(It[1===e[o].UpdaterUserType?K:L]),time:Dt(Et(e[o].DateUpdate))}):"",edit:Ht(It[W],{minutes:Math.floor(t.editExpires/6e4)}),voteClasses:" "+(p?Ve:qe),more:s?"":Ht(It[x],{label:Ht(It[Y])}),children:s?"":Ht(It[j]),reply:s?"":Ht(It[k],{reply:Zt(r,st)})}),!U[s]||r>U[s]?s?b.append(v):b.prepend(v):(g=b.find("."+ve+"-"+U[s]),s?g.before(v):g.after(v)),u<t.editExpires&&window.setTimeout(function(){dt(r)},t.editExpires-u+at))},tn=function(){var e=kt.scrollTop(),n=kt.height(),r=l.offset(),a=e>=r.top-n&&e<=r.top+l.outerHeight();a&&(kt.off("resize scroll",tn),l.addClass(pe+" "+le),Ot(function(){var e,n=function(){yt(),Bt()};l.html(Ht(It[C],{classes:" "+je+" "+ke,reply:Ht(It[k]),children:Ht(It[j]),more:Ht(It[x],{label:Ht(It[Q])})})),l.prepend(Ht(It[z])),ct(),e=Pt(o),""===e?qt(t.project,n):("1"===e&&Jt(),n())}))};l.on("click","."+Oe,function(e){e.stopPropagation(),e.preventDefault();var n=parseInt($(this).data(oe),10)||0;Yt(n,t.project)}),l.on("click","."+He,function(e){e.stopPropagation(),e.preventDefault(),Vt()}),l.on("click","."+he,function(e){e.stopPropagation(),e.preventDefault(),zt(!st),Gt()}),l.on("click","."+Me,function(e){e.stopPropagation(),e.preventDefault();var n=$(this),o=n.closest("."+ve),r=o.children("."+Ne),a=parseInt(o.data(ne),10)||null;o.removeClass(Te),o.addClass(ke),r.children("."+fe).remove(),a?r.prepend(Ht(It[z])):r.append(Ht(It[z])),yt(a,St(a),null,a?t.limitReplies:null)}),l.on("click","."+Ae,function(n){n.stopPropagation(),n.preventDefault();var o,r=$(this),a=r.closest("."+ve),i=a.children("."+Ne),s=parseInt(a.data(ne),10)||null,l=a.hasClass(xe);if(u(s),a.children("."+Pe).find("."+Je).focus(),!l)for(a.removeClass(je+" "+Te),a.addClass(xe+" "+ke),o=0;o<e.length;o+=1)if(e[o].Id===s){e[o].ChildrenCount>0&&(i.children("."+fe).remove(),i.append(Ht(It[z])),yt(s,null,Nt(s),t.limitReplies));break}}),l.on("click","."+nt,function(e){e.stopPropagation(),e.preventDefault();var t=$(this),n=t.closest("."+ve),o=n.closest("."+Ne).closest("."+ve),r=parseInt(o.data(ne),10)||null,a=t.html()+",";r||(o=n),o.children("."+Pe).find("."+Ae).trigger("click");var i=o.children("."+Pe).find("."+Je),s=$.trim(i.val()),l=i.data(ie)||"";(""===s||s===l||s===a)&&(i.data(ie,a),i.val(a+" ")),i.focus()}),l.on("click","."+Fe,function(e){e.stopPropagation(),e.preventDefault();var n=$(this),o=n.closest("."+ve),r=o.children("."+Ne),a=parseInt(o.data(ne),10)||null;o.removeClass(je+" "+Te),o.addClass(xe+" "+ke),r.children("."+fe).remove(),r.append(Ht(It[z])),yt(a,null,null,t.limitReplies)}),l.on("click","."+Qe,function(e){e.stopPropagation(),e.preventDefault();var t=$(this).closest("."+ve),n=parseInt(t.data(ne),10)||null;dt(n),t.hasClass(we)&&v(n)}),l.on("click","."+$e,function(e){e.stopPropagation(),e.preventDefault();var n=$(this),o=n.closest("."+ve),r=n.closest("."+Ye),a=r.find("."+_e),i=n.data(re)||"",s=Boolean(i),l=parseInt(o.data(ne),10)||null,d={project:t.project,objectType:t.objectType,objectId:t.objectId,commentId:l,isLike:s};!vt||r.hasClass(Ve)||o.hasClass(ye)||o.hasClass(Ce)||(r.removeClass(qe),r.addClass(Ve),$.ajax({xhrFields:{withCredentials:!0},url:h,method:"POST",data:d,success:function(e){"object"!=typeof e||0!==e.ErrorCode&&-1!==e.ErrorCode?(r.removeClass(Ve),r.addClass(qe)):0===e.ErrorCode&&(s?r.addClass(Xe):r.addClass(Ze),0!==e.Rating?e.Rating>0?(a.removeClass(tt),a.addClass(et)):(a.removeClass(et),a.addClass(tt)):a.removeClass(et+" "+tt),a.html(Tt(e.Rating))),"object"==typeof e&&-50===e.ErrorCode&&(Lt(!1),Wt(),Kt())},error:function(e,t,n){return"error"===t&&"No Transport"===n?void At():(r.removeClass(Ve),void r.addClass(qe))}}))}),l.on("submit","."+We,function(t){if(t.stopPropagation(),t.preventDefault(),vt){var n,o=this,r=$(this),a=r.closest("."+ve),i=a.children("."+Ne),s=r.find("."+Je),l=r.find("."+Be),d=r.find("."+Ge),c=a.children("."+De),u=parseInt(a.data(ne),10)||null,p=o.commentId.value||"",f=function(){window.clearTimeout(o.timer),d.stop(!0,!0),d.hide(),d.empty()},m=function(){d.stop(!0),d.slideUp(ot,f)},h=function(e,t){f(),d.html(Ht(It[F],{header:e,text:t})),d.slideDown(ot),o.timer=window.setTimeout(m,rt)};f(),$.trim(s.val())===(s.data(ie)||"")?s.focus():(n=r.serialize(),s.prop("disabled",!0),l.prop("disabled",!0),$.ajax({xhrFields:{withCredentials:!0},url:r.prop("action"),method:"POST",data:n,success:function(t){var n,o;if(s.prop("disabled",!1),"object"==typeof t){if(0===t.ErrorCode)s.val(""),g(s.get(0));else{switch(t.ErrorCode){case-2:o=Ht(It[Z]);break;case-3:o=Ht(It[_]),dt(u);break;case-4:o=Ht(It[ee]);break;case-50:o=Ht(It[te]);break;default:o=Ht(It[V])}-50===t.ErrorCode?(Lt(!1),Wt(),Kt()):(l.prop("disabled",!1),s.focus()),h(Ht(It[q]),o)}""===p||0!==t.ErrorCode&&-4!==t.ErrorCode||-1===(n=Ct(u))||(0===t.ErrorCode?(e[n].DateUpdate=t.DateUpdate,e[n].Message=t.Message,e[n].UpdaterUserType=t.UpdaterUserType,c.find("."+Ee).html(e[n].Message),c.find("."+Re).html(Ht(It[T],{by:Ht(It[1===e[n].UpdaterUserType?K:L]),time:Dt(Et(e[n].DateUpdate))}))):(e[n].Status=2,e[n].Message="",c.find("."+Ee).html(Ht(It[I])),c.find("."+Re).empty(),a.children("."+Pe).empty()))}else l.prop("disabled",!1),s.focus(),h(Ht(It[q]),Ht(It[V]));""===p&&(i.children("."+fe).remove(),u?i.append(Ht(It[z])):i.prepend(Ht(It[z])),yt(u,null,Nt(u)))},error:function(e,t,n){return"error"===t&&"No Transport"===n?void At():(l.prop("disabled",!1),s.prop("disabled",!1),s.focus(),void h(Ht(It[q]),Ht(It[X])))}}))}}),l.on("change textInput input keyup","."+Je,function(e){var t=$(this),n=$.trim(this.value),o=t.data(ie)||"",r=!vt||""===n||n===o,a=t.data(ae);r!==a&&($(this.form).find("."+Be).prop("disabled",r),t.data(ae,r))}),l.on("blur","."+Je,function(e){var t=$(this),n=$.trim(this.value),o=t.data(ie)||"";n===o&&g(this)}),l.on("keydown","."+Je,function(e){var t=$(this),n=$.trim(this.value),o=t.data(ie)||"";13===e.keyCode&&(e.ctrlKey||e.metaKey)&&""!==n&&n!==o&&$(this.form).submit(),(27===e.keyCode&&!e.ctrlKey&&!e.altKey&&!e.shiftKey&&!e.metaKey||13===e.keyCode&&(e.ctrlKey||e.metaKey)&&n===o)&&(t.val(""),t.blur(),g(this))}),ut.push(lt),pt.push(function(){var t,n;for(t=0;t<e.length;t+=1)n=l.find("."+ve+"-"+(e[t].Id||0)),n.removeClass(je),n.addClass(xe);ct(),gt(),yt(null,null,St()-1)}),ft.push(function(){gt(),ct(),_t()}),mt.push(d),ht.push(c),kt.on("resize scroll",tn),tn()})}}(jQuery);
